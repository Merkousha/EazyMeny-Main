# User Story 01: ثبت‌نام رستوران

## شناسه: US-001
**اولویت:** بالا  
**فاز:** MVP  
**تخمین زمان:** 3 روز

---

## شرح User Story

**به عنوان یک** مدیر رستوران  
**می‌خواهم** در پلتفرم EazyMenu ثبت‌نام کنم  
**تا بتوانم** حضور دیجیتال برای رستوران خود ایجاد کرده و از خدمات پلتفرم استفاده کنم.

---

## معیارهای پذیرش (Acceptance Criteria)

### سناریو 1: ثبت‌نام موفق
**Given:** کاربر در صفحه ثبت‌نام است  
**When:** فرم را با اطلاعات معتبر پر می‌کند:
- نام رستوران: "رستوران سنتی گلستان"
- نام مدیر: "علی احمدی"
- شماره موبایل: "09121234567"
- ایمیل: "info@golestan.com"
- آدرس: "تهران، خیابان ولیعصر، پلاک 123"
- رمز عبور قوی: حداقل 8 کاراکتر شامل حروف، اعداد و نماد

**Then:**
- سیستم کد تایید 6 رقمی پیامکی ارسال می‌کند
- کاربر به صفحه تایید کد هدایت می‌شود
- پیام موفقیت نمایش داده می‌شود: "کد تایید به شماره موبایل شما ارسال شد"

### سناریو 2: تایید کد پیامکی
**Given:** کاربر کد تایید را دریافت کرده است  
**When:** کد صحیح را وارد می‌کند  
**Then:**
- حساب کاربری فعال می‌شود
- کاربر به صفحه انتخاب پلن اشتراک هدایت می‌شود
- پیام خوش‌آمدگویی نمایش داده می‌شود

### سناریو 3: شماره موبایل تکراری
**Given:** کاربر در صفحه ثبت‌نام است  
**When:** شماره موبایلی که قبلاً ثبت شده را وارد می‌کند  
**Then:**
- سیستم خطای زیر را نمایش می‌دهد: "این شماره موبایل قبلاً ثبت شده است"
- لینک "ورود به حساب کاربری" نمایش داده می‌شود
- لینک "بازیابی رمز عبور" در صورت فراموشی رمز

### سناریو 4: اعتبارسنجی ورودی‌ها
**Given:** کاربر در صفحه ثبت‌نام است  
**When:** فیلدها را با داده‌های نامعتبر پر می‌کند  
**Then:**
- برای شماره موبایل نامعتبر: "لطفاً شماره موبایل معتبر وارد کنید (09XXXXXXXXX)"
- برای ایمیل نامعتبر: "فرمت ایمیل صحیح نیست"
- برای رمز عبور ضعیف: "رمز عبور باید حداقل 8 کاراکتر و شامل حروف بزرگ، کوچک، عدد و نماد باشد"
- برای فیلد خالی: "این فیلد الزامی است"

### سناریو 5: انقضای کد تایید
**Given:** کاربر کد تایید را دریافت کرده است  
**When:** بیش از 5 دقیقه از ارسال کد می‌گذرد و کد وارد می‌شود  
**Then:**
- سیستم خطا نمایش می‌دهد: "کد تایید منقضی شده است"
- دکمه "ارسال مجدد کد" فعال می‌شود
- کاربر می‌تواند کد جدید درخواست کند

---

## جزئیات فنی

### فیلدهای فرم:
1. **نام رستوران** (الزامی)
   - نوع: Text
   - حداقل: 3 کاراکتر
   - حداکثر: 100 کاراکتر

2. **نام مدیر** (الزامی)
   - نوع: Text
   - حداقل: 3 کاراکتر
   - حداکثر: 50 کاراکتر

3. **شماره موبایل** (الزامی)
   - نوع: Tel
   - فرمت: 09XXXXXXXXX
   - Unique

4. **ایمیل** (الزامی)
   - نوع: Email
   - اعتبارسنجی فرمت
   - Unique

5. **آدرس** (الزامی)
   - نوع: Textarea
   - حداقل: 10 کاراکتر
   - حداکثر: 500 کاراکتر

6. **رمز عبور** (الزامی)
   - نوع: Password
   - حداقل: 8 کاراکتر
   - شامل: حروف بزرگ، حروف کوچک، اعداد، نماد
   - نمایش قدرت رمز عبور (ضعیف/متوسط/قوی)

7. **تکرار رمز عبور** (الزامی)
   - باید با رمز عبور مطابقت داشته باشد

8. **قوانین و مقررات** (الزامی)
   - Checkbox برای قبول قوانین

### API Endpoint:
```
POST /api/auth/register
Content-Type: application/json

Request Body:
{
  "restaurantName": "string",
  "managerName": "string",
  "phoneNumber": "string",
  "email": "string",
  "address": "string",
  "password": "string"
}

Response (Success - 200):
{
  "success": true,
  "message": "کد تایید به شماره موبایل شما ارسال شد",
  "data": {
    "userId": "guid",
    "expiresAt": "datetime"
  }
}

Response (Error - 400):
{
  "success": false,
  "message": "این شماره موبایل قبلاً ثبت شده است",
  "errors": []
}
```

### تایید کد:
```
POST /api/auth/verify-code
Content-Type: application/json

Request Body:
{
  "phoneNumber": "string",
  "code": "string"
}

Response (Success - 200):
{
  "success": true,
  "message": "حساب کاربری شما با موفقیت فعال شد",
  "data": {
    "userId": "guid",
    "token": "jwt-token"
  }
}
```

---

## رفتار UI/UX

### طراحی صفحه:
- طراحی Mobile First
- فرم تک‌ستونه با فضای مناسب
- دکمه‌های بزرگ و قابل لمس
- پیام‌های خطا زیر فیلد مربوطه
- Placeholder های راهنما
- آیکون‌های کمکی

### تجربه کاربری:
- Focus خودکار روی اولین فیلد
- نمایش/مخفی کردن رمز عبور
- اعتبارسنجی Real-time
- نمایش Loading هنگام ارسال
- پیام‌های موفقیت با رنگ سبز
- پیام‌های خطا با رنگ قرمز

### دسترسی‌پذیری:
- استفاده از Label برای تمام فیلدها
- پشتیبانی از کیبورد Navigation
- ARIA Labels مناسب
- کنتراست رنگ مناسب

---

## وابستگی‌ها
- یکپارچگی با سرویس پیامک کاوه‌نگار
- سیستم احراز هویت ASP.NET Core Identity
- پایگاه داده SQL Server

---

## ملاحظات امنیتی
- Hash کردن رمز عبور با bcrypt
- محدودیت تعداد تلاش برای وارد کردن کد (حداکثر 3 بار)
- محدودیت تعداد ارسال مجدد کد (حداکثر 3 بار در ساعت)
- CAPTCHA برای جلوگیری از ثبت‌نام خودکار
- اعتبارسنجی سمت سرور برای تمام ورودی‌ها
- CSRF Token

---

## تست‌ها
- [ ] تست ثبت‌نام با داده‌های معتبر
- [ ] تست شماره تکراری
- [ ] تست اعتبارسنجی فیلدها
- [ ] تست ارسال کد پیامکی
- [ ] تست تایید کد صحیح
- [ ] تست کد نادرست
- [ ] تست انقضای کد
- [ ] تست ارسال مجدد کد
- [ ] تست امنیت (SQL Injection, XSS)
- [ ] تست عملکرد روی موبایل

---

**تاریخ ایجاد:** 2025-10-02  
**آخرین بروزرسانی:** 2025-10-02  
**وضعیت:** ⬜ در انتظار توسعه
