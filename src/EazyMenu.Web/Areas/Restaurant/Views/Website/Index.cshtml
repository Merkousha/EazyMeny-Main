@model EazyMenu.Application.Features.Website.DTOs.RestaurantWebsiteDto

@{
    ViewData["Title"] = "وب‌سایت رستوران";
    var hasWebsite = Model?.Template != null;
    var isPublished = Model?.IsPublished ?? false;
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <h2 class="mb-0">
                    <i class="bi bi-globe me-2"></i>
                    مدیریت وب‌سایت
                </h2>
                @if (hasWebsite)
                {
                    <div class="btn-group">
                        @if (isPublished)
                        {
                            <a asp-action="Preview" class="btn btn-info" target="_blank">
                                <i class="bi bi-eye"></i>
                                مشاهده وب‌سایت
                            </a>
                            <form asp-action="Unpublish" method="post" class="d-inline">
                                <button type="submit" class="btn btn-warning" onclick="return confirm('آیا مطمئن هستید؟')">
                                    <i class="bi bi-pause-circle"></i>
                                    برداشتن از انتشار
                                </button>
                            </form>
                        }
                        else
                        {
                            <form asp-action="Publish" method="post" class="d-inline">
                                <button type="submit" class="btn btn-success">
                                    <i class="bi bi-check-circle"></i>
                                    انتشار وب‌سایت
                                </button>
                            </form>
                        }
                    </div>
                }
            </div>
        </div>
    </div>

    @if (!hasWebsite)
    {
        <!-- وب‌سایت هنوز انتخاب نشده -->
        <div class="row">
            <div class="col-lg-8 offset-lg-2">
                <div class="card border-0 shadow-sm text-center py-5">
                    <div class="card-body">
                        <div class="mb-4">
                            <i class="bi bi-globe" style="font-size: 4rem; color: #6c757d;"></i>
                        </div>
                        <h3 class="mb-3">هنوز وب‌سایتی ندارید!</h3>
                        <p class="text-muted mb-4">
                            با انتخاب یک قالب زیبا، وب‌سایت اختصاصی رستوران خود را در چند دقیقه ایجاد کنید.
                        </p>
                        <a asp-action="Templates" class="btn btn-primary btn-lg">
                            <i class="bi bi-layout-text-window-reverse me-2"></i>
                            انتخاب قالب
                        </a>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <!-- داشبورد وب‌سایت موجود -->
        <div class="row">
            <!-- وضعیت انتشار -->
            <div class="col-md-4 mb-4">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">
                        <h5 class="card-title d-flex align-items-center mb-3">
                            <i class="bi bi-broadcast me-2 text-primary"></i>
                            وضعیت انتشار
                        </h5>
                        @if (isPublished)
                        {
                            <div class="alert alert-success mb-0">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-check-circle-fill fs-3 me-3"></i>
                                    <div>
                                        <strong>منتشر شده</strong>
                                        <br>
                                        <small class="text-muted">
                                            @Model!.PublishedAt.ToPersianDateTime()
                                        </small>
                                    </div>
                                </div>
                            </div>
                        }
                        else
                        {
                            <div class="alert alert-warning mb-0">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-exclamation-triangle-fill fs-3 me-3"></i>
                                    <div>
                                        <strong>پیش‌نویس</strong>
                                        <br>
                                        <small class="text-muted">وب‌سایت هنوز منتشر نشده است</small>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- قالب فعلی -->
            <div class="col-md-4 mb-4">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">
                        <h5 class="card-title d-flex align-items-center mb-3">
                            <i class="bi bi-palette me-2 text-primary"></i>
                            قالب فعلی
                        </h5>
                        <div class="text-center">
                            @if (!string.IsNullOrEmpty(Model!.Template!.ThumbnailUrl))
                            {
                                <img src="@Model.Template.ThumbnailUrl" alt="@Model.Template.Name" 
                                     class="img-fluid rounded mb-3" style="max-height: 120px;">
                            }
                            <h6 class="mb-1">@Model.Template.Name</h6>
                            <span class="badge bg-info">@Model.Template.Type.ToString()</span>
                            <div class="mt-3">
                                <a asp-action="Templates" class="btn btn-sm btn-outline-primary">
                                    <i class="bi bi-arrow-repeat"></i>
                                    تغییر قالب
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- آمار -->
            <div class="col-md-4 mb-4">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">
                        <h5 class="card-title d-flex align-items-center mb-3">
                            <i class="bi bi-bar-chart me-2 text-primary"></i>
                            آمار
                        </h5>
                        <ul class="list-unstyled mb-0">
                            <li class="d-flex justify-content-between mb-2">
                                <span class="text-muted">تعداد بخش‌ها:</span>
                                <strong>@Model.Contents.Count</strong>
                            </li>
                            <li class="d-flex justify-content-between mb-2">
                                <span class="text-muted">بخش‌های فعال:</span>
                                <strong class="text-success">@Model.Contents.Count(c => c.IsVisible)</strong>
                            </li>
                            <li class="d-flex justify-content-between mb-2">
                                <span class="text-muted">آخرین به‌روزرسانی:</span>
                                <strong>@DateTime.Now.ToPersianDate()</strong>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- عملیات سریع -->
        <div class="row">
            <div class="col-12">
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <h5 class="card-title mb-4">
                            <i class="bi bi-lightning-charge me-2"></i>
                            عملیات سریع
                        </h5>
                        <div class="row g-3">
                            <div class="col-md-3">
                                <a asp-action="Customize" class="btn btn-outline-primary w-100 py-3">
                                    <i class="bi bi-palette fs-4 d-block mb-2"></i>
                                    سفارشی‌سازی
                                    <small class="d-block text-muted mt-1">رنگ، فونت، لوگو</small>
                                </a>
                            </div>
                            <div class="col-md-3">
                                <a asp-action="Templates" class="btn btn-outline-secondary w-100 py-3">
                                    <i class="bi bi-layout-text-window-reverse fs-4 d-block mb-2"></i>
                                    قالب‌ها
                                    <small class="d-block text-muted mt-1">تغییر قالب</small>
                                </a>
                            </div>
                            <div class="col-md-3">
                                <a asp-action="EditContent" asp-route-sectionType="0" class="btn btn-outline-info w-100 py-3">
                                    <i class="bi bi-file-earmark-text fs-4 d-block mb-2"></i>
                                    محتوا
                                    <small class="d-block text-muted mt-1">ویرایش بخش‌ها</small>
                                </a>
                            </div>
                            <div class="col-md-3">
                                <a asp-action="Preview" target="_blank" class="btn btn-outline-success w-100 py-3">
                                    <i class="bi bi-eye fs-4 d-block mb-2"></i>
                                    پیش‌نمایش
                                    <small class="d-block text-muted mt-1">مشاهده نهایی</small>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- لیست بخش‌ها -->
        <div class="row">
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title mb-4">
                            <i class="bi bi-list-ul me-2"></i>
                            بخش‌های وب‌سایت
                        </h5>
                        <div class="table-responsive">
                            <table class="table table-hover align-middle">
                                <thead class="table-light">
                                    <tr>
                                        <th>ردیف</th>
                                        <th>نام بخش</th>
                                        <th>وضعیت</th>
                                        <th>محتوا</th>
                                        <th>عملیات</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var content in Model.Contents.OrderBy(c => c.DisplayOrder))
                                    {
                                        <tr>
                                            <td>@content.DisplayOrder</td>
                                            <td>
                                                <strong>@content.SectionTitle</strong>
                                                @if (!content.IsEditable)
                                                {
                                                    <span class="badge bg-secondary ms-2">غیرقابل ویرایش</span>
                                                }
                                                @if (content.IsRequired)
                                                {
                                                    <span class="badge bg-danger ms-2">الزامی</span>
                                                }
                                            </td>
                                            <td>
                                                @if (content.IsVisible)
                                                {
                                                    <span class="badge bg-success">
                                                        <i class="bi bi-eye"></i>
                                                        نمایش
                                                    </span>
                                                }
                                                else
                                                {
                                                    <span class="badge bg-secondary">
                                                        <i class="bi bi-eye-slash"></i>
                                                        مخفی
                                                    </span>
                                                }
                                            </td>
                                            <td>
                                                @if (content.UseDefaultContent)
                                                {
                                                    <span class="text-muted">
                                                        <i class="bi bi-file-earmark"></i>
                                                        محتوای پیش‌فرض
                                                    </span>
                                                }
                                                else
                                                {
                                                    <span class="text-success">
                                                        <i class="bi bi-pencil-square"></i>
                                                        سفارشی شده
                                                    </span>
                                                }
                                            </td>
                                            <td>
                                                @if (content.IsEditable)
                                                {
                                                    <a asp-action="EditContent" asp-route-sectionType="@((int)content.SectionType)" 
                                                       class="btn btn-sm btn-primary">
                                                        <i class="bi bi-pencil"></i>
                                                        ویرایش
                                                    </a>
                                                }
                                                else
                                                {
                                                    <button class="btn btn-sm btn-secondary" disabled>
                                                        <i class="bi bi-lock"></i>
                                                        غیرقابل ویرایش
                                                    </button>
                                                }
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

@section Styles {
    <style>
        .card {
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-2px);
        }
        .btn-group form {
            display: inline;
        }
    </style>
}
